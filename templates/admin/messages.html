<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Box Modal</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .modal-dialog {
            max-width: 600px; /* Set a fixed width for the modal */
        }
    
        .modal-content {
            max-height: 80vh; /* Set a fixed height for the modal */
            overflow-y: auto; /* Enable vertical scrolling */
        }
    
        .modal-body {
        max-height: 70vh; /* Adjust as needed */
        overflow-y: auto;
        padding-bottom: 0; /* Remove extra padding */
    }


    
        .message-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        .message-header h5 {
            margin: 0;
            font-size: 1.2rem;
        }
    
        .message-header span {
            font-size: 0.9rem;
            color: gray;
        }
    
        .message-content {
            margin-top: 10px;
        }
    
        .message-footer {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #555;
        }
    </style>
    
</head>
<body>
    <!-- Messages Modal -->
        <!-- Messages Modal -->
        <div class="modal fade" id="messageBoxModal" tabindex="-1" aria-labelledby="messageBoxModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="messageBoxModalLabel">Messages</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- New Messages Section -->
                        <h6>New Messages</h6>
                        <div>
                            {% for notification in notifications if not notification.is_read %}
                            <div class="message-card">
                                <div class="message-header">
                                    <h5>Message Type: <span>{{ notification.type }}</span></h5>
                                    <span>{{ notification.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                                </div>
                                <div class="message-content">
                                    <p>{{ notification.message }}</p>
                                </div>
                                <div class="message-footer">
                                    <span>Sender ID: {{ notification.sender_id }}</span>
                                    <span>Type: {{ notification.type }}</span>
                                </div>
                            </div>
                            {% else %}
                            <p>No new messages.</p>
                            {% endfor %}
                        </div>
        
                        <hr>
        
                        <!-- Old Messages Section -->
                        <h6>Old Messages</h6>
                        <div>
                            {% for notification in notifications if notification.is_read %}
                            <div class="message-card">
                                <div class="message-header">
                                    <h5>Message Type: <span>{{ notification.type }}</span></h5>
                                    <span>{{ notification.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                                </div>
                                <div class="message-content">
                                    <p>{{ notification.message }}</p>
                                </div>
                                <div class="message-footer">
                                    <span>Sender ID: {{ notification.sender_id }}</span>
                                    <span>Type: {{ notification.type }}</span>
                                </div>
                            </div>
                            {% else %}
                            <p>No old messages.</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
        
    

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#messageBoxModal').on('shown.bs.modal', function () {
                $.ajax({
                    type: 'POST',
                    url: '/mark_notifications_read',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token() }}'  // Include CSRF token
                    },
                    success: function() {
                        console.log('Notifications marked as read');
                    },
                    error: function() {
                        console.log('Error marking notifications as read');
                    }
                });
            });
        });
    </script>
    
</body>
</html>